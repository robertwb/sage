#!/bin/sh

# Syntax:
# ./install path-to-gmp-source-tree

# copies various files from this directory into appropriate places in GMP,
# to enable the fast gcd code.

# WARNING: these changes will overwrite any others! They should preferably
# be applied to a clean 4.2.1 source tree!


if test "$#" != 1; then
  echo "usage: ./install <gmp-dir>";
  exit;
fi


PATH_TO_GMP=$1

echo "Fast gcd patch:"
echo "Moving files that are to be replaced to *.orig ..."
mv $PATH_TO_GMP/gmp-impl.h $PATH_TO_GMP/gmp-impl.h.orig
mv $PATH_TO_GMP/configure $PATH_TO_GMP/configure.orig
mv $PATH_TO_GMP/configure.in $PATH_TO_GMP/configure.in.orig
mv $PATH_TO_GMP/mpn/Makefile.am $PATH_TO_GMP/mpn/Makefile.am.orig
mv $PATH_TO_GMP/mpn/Makefile.in $PATH_TO_GMP/mpn/Makefile.in.orig
mv $PATH_TO_GMP/mpn/generic/gcd.c $PATH_TO_GMP/mpn/generic/gcd.c.orig
mv $PATH_TO_GMP/mpn/generic/gcdext.c $PATH_TO_GMP/mpn/generic/gcdext.c.orig

echo "Copying new files across..."
cp ./gmp-impl.h $PATH_TO_GMP/gmp-impl.h
cp ./configure $PATH_TO_GMP/configure
cp ./configure.in $PATH_TO_GMP/configure.in
cp ./Makefile.am $PATH_TO_GMP/mpn/Makefile.am
cp ./Makefile.in $PATH_TO_GMP/mpn/Makefile.in
cp ./gcd.c $PATH_TO_GMP/mpn/generic/gcd.c
cp ./gcdext.c $PATH_TO_GMP/mpn/generic/gcdext.c
cp ./hgcd.c $PATH_TO_GMP/mpn/generic/hgcd.c
cp ./hgcd2.c $PATH_TO_GMP/mpn/generic/hgcd2.c
cp ./qstack.c $PATH_TO_GMP/mpn/generic/qstack.c

echo "Done."
