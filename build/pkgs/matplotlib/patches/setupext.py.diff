--- setupext.py.orig	2008-12-12 08:22:19.000000000 -0800
+++ setupext.py	2008-12-12 08:20:55.000000000 -0800
@@ -44,14 +44,16 @@
 import os
 import re
 
+### FOR SAGE
+sage_inc = os.environ['SAGE_LOCAL'] + '/include/'
+sage_lib = os.environ['SAGE_LOCAL'] + '/lib/'
 
 basedir = {
     'win32'  : ['win32_static',],
-    'linux2' : ['/usr/local', '/usr'],
+    'linux2' : [sage_lib],
     'linux'  : ['/usr/local', '/usr',],
     'cygwin' : ['/usr/local', '/usr',],
-    'darwin' : ['/sw/lib/freetype2', '/sw/lib/freetype219', '/usr/local',
-                '/usr', '/sw', '/usr/X11R6'],
+    'darwin' : [sage_lib],
     'freebsd4' : ['/usr/local', '/usr'],
     'freebsd5' : ['/usr/local', '/usr'],
     'freebsd6' : ['/usr/local', '/usr'],
@@ -328,7 +330,9 @@
 
     module.include_dirs.extend(incdirs)
     module.include_dirs.append('.')
+    module.include_dirs.append(sage_inc)    	
     module.library_dirs.extend(libdirs)
+    module.library_dirs.extend([sage_lib])
 
 def getoutput(s):
     'get the output of a system command'
@@ -1076,6 +1080,7 @@
         #      of distros.
 
         # Query Tcl/Tk system for library paths and version string
+        tk_ver = ''
         try:
             tcl_lib_dir, tk_lib_dir, tk_ver = query_tcltk()
         except:
