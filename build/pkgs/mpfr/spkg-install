#!/bin/sh

build()
{
    EXTRA=""

    if [ ! -f "$SAGE_LOCAL/include/gmp.h" ]; then
         EXTRA="--disable-static --enable-shared"
    fi

    if [ $UNAME = "CYGWIN" ]; then
         EXTRA="--disable-static --enable-shared"
    fi

    ./configure --prefix=$SAGE_LOCAL --with-gmp=$SAGE_LOCAL \
                 CFLAGS="$CFLAGS $SHAREDFLAGS -O2" CXX="$CXX" \
                 CXXFLAGS="$CXXFLAGS $SHAREDFLAGS" LDFLAGS="$LDFLAGS" \
                 GMP_PREFIX="$SAGE_LOCAL" $EXTRA


    echo "Building and install mpfr"
    $MAKE install

}

cd src

build

if [ $? -eq 0 -a -f $SAGE_LOCAL/include/mpfr.h ];  then
    exit 0
else
    echo "An error occured while building mpfr."
    exit 1
fi
