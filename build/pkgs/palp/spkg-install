#!/bin/sh

# Move over the GNU makefile to the the file 'Makefile'.
# If SAGE64 is set to yes, add an '-m64' using 'sed'

if [ "x$SAGE64" = xyes ] ; then
  echo "Creating a 64-bit version of PALP"
  sed 's/^CFLAGS=/CFLAGS=-m64 /g' src/GNUmakefile > src/Makefile
  # We must delete src/GNUmakefile, otherwise that gets used in preference to Makefile.
  rm src/GNUmakefile
else
  mv -f src/GNUmakefile src/Makefile
fi

if [ $? -ne 0 ]; then
    echo "Error patching PALP."
    exit 1
fi

cd src

make

if [ $? -ne 0 ]; then
    echo "Error building PALP."
    exit 1
fi

cp poly.x class.x cws.x nef.x "$SAGE_LOCAL/bin/"

if [ $? -ne 0 ]; then
    echo "Error installing PALP."
    exit 1
fi
