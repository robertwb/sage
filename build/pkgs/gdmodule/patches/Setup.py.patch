--- ../src/Setup.py	2007-01-10 10:23:03.000000000 -0800
+++ Setup.py	2010-04-06 11:16:30.316434351 -0700
@@ -61,13 +61,12 @@
 import os
 if os.uname()[0][:6] == "CYGWIN":
     want_libs = [
-        "gd", "png", "z", "freetype", "libiconv"
+        "gd", "png12", "z", "freetype", "iconv", "fontconfig",
     ]
     libs = filetest(libdirs, want_libs)
-    libs.append('libiconv')
 else:
     want_libs = [
-        "gd", "png", "z", "freetype"
+        "gd", "png12", "z", "freetype"
     ]
     libs = filetest(libdirs, want_libs)
 
@@ -92,18 +91,22 @@
 if "Xpm" in libs and "X11" not in libs:
     remove("Xpm", libs)
 
-if "png" in libs and "z" not in libs:
-    remove("png", libs)
+if "png12" in libs and "z" not in libs:
+    remove("png12", libs)
 
-if "z" in libs and "png" not in libs:
-    remove("png", libs)
+if "z" in libs and "png12" not in libs:
+    remove("png12", libs)
 
 # build the macro list
 
 macros = []
 
 for l in libs:
-    macros.append(( "HAVE_LIB%s" % l.upper(), None ))
+    if l == "png12":
+       macros.append(( "HAVE_LIBPNG", None ))
+    else:
+       macros.append(( "HAVE_LIB%s" % l.upper(), None ))
+
 
 # OK, now do it!
 
