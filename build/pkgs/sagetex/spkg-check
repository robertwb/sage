#!/bin/sh

# this runs Sage on the generated .sage files to see if they work ok

# typesetting the example file requires TikZ version 2.00, as well as
# tkz-berge.sty and tkz-graph.sty.

typeset()
{
    pdflatex -interaction=nonstopmode $1
    if [ $? -ne 0 ]
    then
        echo "Error typesetting $1! To fully test SageTeX, make sure"
        echo "LaTeX can find sagetex.sty, and that TikZ (version 2.00"
        echo "or newer), tkz-berge.sty and tkz-graph.sty is installed."
        exit 1
    fi
}

checkdotsage()
{
    sage $1.sage
    if [ $? -ne 0 ]
    then
        echo "Error running Sage on $1.sage!"
        exit 1
    else
        echo "No problem that spkg-check can detect running Sage on $1.sage."
    fi
}

if [ "$(which latex)" -a "$(kpsewhich tkz-berge.sty)" ]
then
    cd src

    typeset example.tex
    checkdotsage example

    typeset sagetexpackage.dtx
    checkdotsage sagetexpackage
else
    echo "LaTeX isn't installed (or isn't in \$PATH) or tkz-berge.sty couldn't be found. Skipping test of SageTeX spkg."
fi

# if we get here, we assume the .sage files are good, and exit successfully
exit 0
