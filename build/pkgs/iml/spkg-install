#!/bin/sh

cp patches/configure src

cd src

if [ -f "$SAGE_LOCAL"/lib/libatlas.so ]; then
    ./configure --prefix="$SAGE_LOCAL" --enable-shared --with-gmp-include="$SAGE_LOCAL"/include --with-gmp-lib="$SAGE_LOCAL"/lib --with-atlas-include="$SAGE_LOCAL"/include --with-atlas-lib="$SAGE_LOCAL"/lib
else
    ./configure --prefix="$SAGE_LOCAL" --enable-shared --with-gmp-include="$SAGE_LOCAL"/include --with-gmp-lib="$SAGE_LOCAL"/lib --with-atlas-include="`pwd`" --with-atlas-lib=/usr/lib/
fi

if [ $? -ne 0 ]; then
    echo "Error configuring IML"
    exit 1
fi

make

if [ $? -ne 0 ]; then
    echo "Error building IML"
    exit 1
fi

make install

if [ $? -ne 0 ]; then
    echo "Error installing IML"
    exit 1
fi
