#!/usr/bin/make -f

DEB_AUTO_UPDATE_AUTOCONF = 1
DEB_AUTO_UPDATE_DEBIAN_CONTROL = 1
include /usr/share/cdbs/1/rules/debhelper.mk
include /usr/share/cdbs/1/class/autotools.mk
include /usr/share/cdbs/1/rules/patchsys-quilt.mk

CFLAGS += -fPIC
CXXFLAGS += -fPIC
# Singular doesn't use DESTDIR, so we'll try to put DESTDIR in PREFIX
PREFIX=$(DEB_DESTDIR)/usr
DEB_CONFIGURE_EXTRA_FLAGS += --with-apint=gmp --with-gmp=/usr/lib --with-ntl --with-NTL --without-MP --enable-gmp=/usr/lib --enable-Singular --enable-factory --enable-libfac --enable-IntegerProgramming --disable-debug --prefix=$(PREFIX) --exec_prefix=$(PREFIX) --libdir=$(PREFIX)/lib/singular --libexecdir=$(PREFIX)/lib/singular --bindir=$(PREFIX)/bin --includedir=$(PREFIX)/include/singular/ --without-lex --without-bison --disable-doc --without-Boost
DEB_MAKE_INVOKE += slibdir=$(PREFIX)/share/singular install_slibdir=$(PREFIX)/share/singular
DEB_MAKE_BUILD_TARGET = distclean
DEB_MAKE_CLEAN_TARGET = distclean
DEB_MAKE_INSTALL_TARGET = install-nolns

common-install-impl::
	+$(DEB_MAKE_INVOKE) libsingular
	+$(DEB_MAKE_INVOKE) install-libsingular

clean::
	rm -f configure
	find . -name *.dl_o -exec rm \{\} \;
	find . -name *.o -exec rm \{\} \;
	find . -name *.og -exec rm \{\} \;
	find . -name *.so -exec rm \{\} \;
	find . -name *.a -exec rm \{\} \;
	find . -name *.o_ndebug -exec rm \{\} \;
	find . -name *.op -exec rm \{\} \;
