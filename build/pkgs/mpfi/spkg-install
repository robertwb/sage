#!/usr/bin/env bash

if [ "$SAGE_LOCAL" = "" ]; then
   echo "SAGE_LOCAL undefined ... exiting";
   echo "Maybe run 'sage -sh'?"
   exit 1
fi

if [ "$SAGE64" = "yes" ]; then
   echo "64 bit build"
   CFLAGS="-O2 -g -m64 -fPIC"; export CFLAGS
   CXXLAGS="-O2 -g -m64 -fPIC"; export CXXFLAGS
   LDFLAGS="-m64 "; export LDFLAGS
else
   CFLAGS="-O2 -g -fPIC"; export CFLAGS
fi

cd src

./configure --prefix="$SAGE_LOCAL" --with-mpfr-dir="$SAGE_LOCAL" --with-gmp-dir="$SAGE_LOCAL"

if [ $? -ne 0 ]; then
    echo "Error configuring mpfi"
    exit 1
fi

echo "Building and installint mpfi"
$MAKE install

if [ $? -eq 0 -a -f $SAGE_LOCAL/include/mpfi.h ]; then
    exit 0
else
    echo "An error occurred while building mpfi."
    exit 1
fi
