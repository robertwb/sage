#!/bin/sh

cp patches/lanczos.h  src/

cd src

if [ `uname -m` = "x86_64" ]; then
    $CP makefile.opteron makefile
else
    $CP makefile.sage makefile
fi

$MAKE

if [ $? -ne 0 ]; then
    echo "Error building William Hart's Quadratic Sieve"
    if [ `uname -m` = "x86_64" ]; then
       $CP makefile.sage makefile
       $MAKE
    else
       exit 1
    fi
fi

if [ $? -ne 0 ]; then
    echo "Error building William Hart's Quadratic Sieve"
    exit 1
fi

if [ ! -f QuadraticSieve ]; then
    echo "Error building William Hart's Quadratic Sieve -- no file QuadraticSieve was produced."
    exit 1
fi

$CP QuadraticSieve "$SAGE_LOCAL"/bin/

exit 0
