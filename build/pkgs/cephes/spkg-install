#!/usr/bin/env bash

if [ "$UNAME" != "CYGWIN" ]; then
    echo "We do not install the cephes library on any operating system except Cygwin."
    exit 0
fi

CUR=`pwd`

function patch {
    cd "$CUR"
    cp patches/complex.h src/
}

function make_complex_h {
    cd "$CUR"
    cp src/complex.h "$SAGE_LOCAL"/include
}

function make_single {
    cd "$CUR"
    cd src/single
    make

    cp libmf.a "$SAGE_LOCAL"/lib/
    cp protos.h "$SAGE_LOCAL"/include/cephes_single.h

    cd "$CUR"
}

function make_double {
    cd "$CUR"
    cp patches/double/makefile  src/double

    cd src/double

    make

    cp libmd.a "$SAGE_LOCAL"/lib/

    cd "$CUR"
}

function make_ldouble {
    cd "$CUR"
    cp patches/ldouble/makefile  src/ldouble

    cd src/ldouble
    make

    cp libml.a "$SAGE_LOCAL"/lib/
    cp protos.h "$SAGE_LOCAL"/include/cephes_ldouble.h

    cd "$CUR"
}

function make_c9x_complex {
    cd "$CUR"

    cp patches/c9x-complex/*.c src/c9x-complex/
    cp patches/c9x-complex/makefile src/c9x-complex/

    cd src/c9x-complex/

    make

    cp libmc.a "$SAGE_LOCAL"/lib/

    cd "$CUR"
}

function build {
    make_complex_h
    make_single
    make_double
    make_ldouble
    make_c9x_complex
}

patch
build
