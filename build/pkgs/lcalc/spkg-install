#!/bin/sh

cd src

CFLAGS="$CFLAGS -O2 -g -Wa,-W -fno-exceptions -Wno-deprecated -static-libgcc"
export CFLAGS

# disable Cygwin build for now
if [ "$UNAME" = "CYGWIN" ]; then
#    cp patches/Lcommandline_elliptic.cc src/src/
    echo "Sorry, the lcalc build is currently broken"
    echo 1
fi

cd src

echo "Building Rubinstein's lcalc program using $CXX..."

success() {
    if [ $? -ne 0 ]; then
        echo "Error building lcalc '$1'"
        exit 1
    fi
}

export DEFINES=""
cp Makefile.sage Makefile
make lcalc
success 'plain'

echo "Now striping"
strip lcalc*

echo "Now copying over binary"
cp lcalc "$SAGE_LOCAL"/bin
success 'install'
