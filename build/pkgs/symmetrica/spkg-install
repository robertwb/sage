#!/usr/bin/env bash

if [ "$SAGE_LOCAL" = "" ]; then
   echo "SAGE_LOCAL undefined ... exiting";
   echo "Maybe run 'sage -sh'?"
   exit 1
fi

if [ `uname` = "Darwin" -a "$SAGE64" = "yes" ]; then
    CFLAGS="-01 -m64 -fPIC -g -DFAST -DALLTRUE" && export CFLAGS
else
    CFLAGS="-O1 -fPIC -g -DFAST -DALLTRUE"; export CFLAGS
fi

cd src
$MAKE -f makefile

if [ $? -ne 0 ]; then
    echo "Error building symmetrica."
    exit 1
fi

ar crs libsymmetrica.a *.o
cp libsymmetrica.a $SAGE_ROOT/local/lib/
if [[ ! -d $SAGE_ROOT/local/include/symmetrica ]]
	then
	mkdir $SAGE_ROOT/local/include/symmetrica
fi
cp def.h macro.h $SAGE_ROOT/local/include/symmetrica
