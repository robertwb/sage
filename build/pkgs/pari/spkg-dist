#!/usr/bin/env python

import os, sys, time

os.chdir('src/')

def cmd(x):
    print x
    if os.system(x):
        print "(Failed.)"

cmd("rm -rf Odos")

# Now modify init.c so we abort instead of exiting, so that
# Sage can catch errors that PARI raises.
print "Modifying init.c for Sage usage"

init_c = "src/language/init.c"
init = open(init_c).read()
i = init.find('fprintferr("  ***   Error in the PARI system.')
init = init[:i] + "\n\tabort();\n\t" + init[i:]
i = init.find('msg="unknown signal";')
init = init[:i] + "\n\tabort();\n\t" + init[i:]
open(init_c,'w').write(init)

print "Modifying  src/kernel/gmp/mp.c"
mp_file = "src/kernel/gmp/mp.c"
mp = open(mp_file).read()
mp = mp.replace('mp_set_memory_functions', 'return 0; mp_set_memory_functions')
open(mp_file,'w').write(mp)
