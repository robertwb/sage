#!/bin/sh

build() {
   if [ -d $SAGE_ROOT/devel/$1/ ]; then
      cd $SAGE_ROOT/devel/$1/
      chmod +x ./install
      time ./install $SAGE_ROOT
      if [ $? -ne 0 ]; then
         echo "Error building $1"
         exit 1
      fi
   #else
      #echo "The directory $SAGE_ROOT/devel/$1/ does not exist."
   fi
}

$SAGE_ROOT/local/bin/sage-env 1>/dev/null

if [ "$1" != "" ]; then
    # make devel/sage point to devel/$1
    cd "$SAGE_ROOT/devel/"
    if [ ! -d "sage-$1" ]; then
        # this will happen a lot because of people (=me) making typos.
        echo "No such branch '$SAGE_ROOT/devel/sage-$1'"
        exit 1
    fi
    ln -snf "sage-$1" sage
fi

if [ ! -d "$SAGE_ROOT/devel/sage" ]; then
    echo "There is no directory '$SAGE_ROOT/devel/sage'"
    exit 1
fi

build "sage"
