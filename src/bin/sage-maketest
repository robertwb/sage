#!/bin/bash


echo "---------------------" > "$SAGE_ROOT"/tmp/test.log
echo `date` >> "$SAGE_ROOT"/tmp/test.log

# Run DSAGE unit tests
sage-dsage-trial 2>&1 | tee .test-dsage.log | tee -a "$SAGE_ROOT"/tmp/test.log

if [ -d $SAGE_ROOT/examples ]; then
   cd "$SAGE_ROOT"/examples
   ./test_all | tee -a "$SAGE_ROOT"/tmp/test.log
fi

echo "Testing SAGE documentation"

echo "Testing SAGE tutorial"
cd "$SAGE_ROOT"/devel/doc/tut
sage -t "$@" tut.tex 2>&1 | tee -a "$SAGE_ROOT"/tmp/test.log

echo "Testing SAGE programming guide"
cd "$SAGE_ROOT"/devel/doc/prog
sage -t "$@" prog.tex 2>&1 | tee -a "$SAGE_ROOT"/tmp/test.log

echo "Testing SAGE constructions guide"
cd "$SAGE_ROOT"/devel/doc/const
sage -t "$@" const.tex 2>&1 | tee -a "$SAGE_ROOT"/tmp/test.log


# Run SAGE library doctests, which end with a summary report.
cd "$SAGE_ROOT"
./sage -t devel/sage/sage 2>&1 | tee -a "$SAGE_ROOT"/tmp/test.log

# Print the small summary report for dsage unit tests, if necessary.
# TODO -- skip this for now.
grep "ERROR occurred" .test-dsage.log | tee -a "$SAGE_ROOT"/tmp/test.log

cat "$SAGE_ROOT"/tmp/test.log >> "$SAGE_ROOT"/test.log

echo "Please see $SAGE_ROOT/tmp/test.log for the complete log from this test."

exit 0
